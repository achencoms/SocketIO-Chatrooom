<html>
<head>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
  <script type="text/javascript" charset="utf-8">
      var socket = io.connect('http://' + document.domain + ':' + location.port + location.pathname);
      socket.on('connect', function() {
          //socket.emit('my event', {data: 'I\'m connected!'});
      });
      var activeChat = "general";

      $(document).ready(function(){
        $("nav").on("click","a",function(e){ //instead of click, because I need to modify dynamically added elements
          e.preventDefault();
          activeChat = $(this).text();
          if(!$(this).hasClass("active")){
            $("nav a").removeClass("active");
            $(this).addClass("active");
          }
          //Make sure that the correct chatbox is visible for user
          $(".chat").each(function(){
            var boxID = $(this).attr("id");
            if(boxID == activeChat){
              $(this).show();
            }
            else $(this).hide();
          });
        });
        $("#message").submit(function(event){
          event.preventDefault();
          if($("#m").val()){
            socket.send($(this).find("#m").val());
            $("#m").val("");
          }
        });
        $("#join_room").submit(function(event){
          event.preventDefault();
          if($("#room").val()){
            socket.emit('join', {"room" : $(this).find("#room").val()});
            $("#room").val("");
          }
        });
      });
      socket.on('userMessage', function(message) {
          $("#" + activeChat).append("<p>"+ message['user'] + ": " + message['m'] + "</p>");
          $("#" + activeChat).scrollTop($("#display")[0].scrollHeight);
      });
      socket.on('message', function(message) {
          $("#" + activeChat).append("<p>"+ message + "</p>");
          $("#" + activeChat).scrollTop($("#display")[0].scrollHeight);
      });
      socket.on('room_check', function(data) {
          var rooms = data['rooms'];
          $.each(rooms,function(index,value){
            if(!$("nav a #" + value).length){
              var newLink = $('<a class="nav-link" href="#">' + value + '</a>'); // new link added
              var newChat = $('<div class="container form-control chat mx-auto" id ="' + value + '" style="height:50%; display:none; overflow-y:scroll"></div>');
              $("nav").append(newLink);
              $("#chatboxes").append(newChat);
              return false;
            }
          });
      });
  </script>
</head>
  <body>
  <div class="row">
    <!--Side Navbar-->
    <div class="col-md-2">
      <nav class="nav nav-pills flex-column">
        <a class="nav-link active" href="#">general</a>
        <a class="nav-link" href="#">display2</a>
      </nav>
    </div>


    <div class="col-md-8">
      <div class= "container">
        <h1 class="display-1"><b>ChatwithMatt</b></h1>
        <div id="chatboxes">
          <div class="container form-control chat mx-auto" id ="general" style="height:50%; overflow-y:scroll"></div>
          <div class="container form-control chat" id ="display2" style="height:50%; display:none; overflow-y:scroll;"></div>
        </div>

        <div class="row">
          <div class="col-md-4">
            <form class="input-group my-1" id="join_room">
                <span class="input-group-addon">Room</span>
                <input class="form-control" type="text" id="room" autofocus="autofocus" placeholder="Room Name">
                <span class="input-group-btn">
                  <button type="submit" class="btn btn-outline-primary" id="join_room">Join</button>
                </span>
            </form>
          </div>
        </div>


        <div class= "container fixed-bottom">
          <form class="input-group" id="message">
            <span class="input-group-addon">Message</span>
            <input class="form-control" type="text" id="m" autofocus="autofocus" placeholder="Enter your message here...">
            <button type="submit" class="btn btn-outline-primary" id="Send">Submit</button>
          </form>
        </div>

      </div>
    </div>
  </div>
  </body>
</html>
